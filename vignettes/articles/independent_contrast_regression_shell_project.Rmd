---
title: "Fully automated regression analysis and log processing with a shell script"
output: rmarkdown::html_vignette
resource_files:
    - unix_shell_project.png
    - unix_shell_project_script.png
    - windows_powershell_project.png
    - windows_powershell_project_script.png
vignette: >
  %\VignetteIndexEntry{Fully automated regression analysis and log processing with a shell script}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

\
The main goal of the __InNOutBT__ package is to readily create input data and
process output data for Meade & Pagel's (2022) [BayesTraits](http://www.evolution.reading.ac.uk/BayesTraitsV4.0.0/BayesTraitsV4.0.0.html) 
program.\

Here in this article, we show how to use __InNOutBT__'s function `BayesTraits.shell.reg.proj`
for producing shell scripts and associated run commands of BayesTraits phylogenetic 
independent contrast regression analyses. Basically, the function `BayesTraits.shell`
uses the directory paths to the tree, mean and linked data files as created with
`BayesTraits.inputs` (see article [here](https://dboslab.github.io/InNOutBT/articles/independent_contrast_regression_inputs.html)),
to automatically produce shell scripts in both Unix and Windows PowerShell formats. 
The resulting single shell script file can then be used for running one or all-in-once
multiple BayesTraits phylogenetic regressions, without manually setting new analyses
with new parameters. The shell script produced with `BayesTraits.shell` should 
have thus all parameters for all analyses with any defined model. In addition to 
save the shell script directly in BayesTraits directory, the function saves all 
the separate running files with BayesTraits specified parameters (bi, it, sa, and
st) for any run, depending on the chosen model of tree transformation. See [BayesTraits V4.0.0 Manual](http://www.evolution.reading.ac.uk/BayesTraitsV4.0.0/Files/BayesTraitsV4.0.0-Manual.pdf)
for further details on each of BayesTraits parameters available for phylogenetic
regression so as to better understand how to set the arguments of `BayesTraits.shell`.\
\

# Setup

__InNOutBT__ is not on CRAN yet but you can install the latest development version 
from [GitHub](https://github.com/):

``` r
#install.packages("devtools")
devtools::install_github("DBOSlab/InNOutBT")
```
```{r, eval = FALSE}
library(InNOutBT)
```
\

# Creating a Unix shell project folder

Set the argument `syst = "unix"` to create a shell script for running the phylogenetic
regressions with macOS Monterey.\

Note that you should give the name of the response variable of your analysis in
the argument `responvar`. Also, you should use the argument `treetransf` to define
any or all (listed as a vector) available tree transformation models that you want
to run the phylogenetic regressions with your input data.\

```{r, eval = FALSE}
library(InNOutBT)

BayesTraits.shell.reg.proj(dir_create_proj = "/Users/domingoscardoso",
                           syst = "unix")
```

```{r, echo = FALSE}
knitr::include_graphics("figures/unix_shell_project.png", dpi = 300)
```

\
\
Note that...
\
```{r, echo = FALSE}
knitr::include_graphics("figures/unix_shell_project_script.png", dpi = 300)
```
\
\

# Running the Unix shell script 

After using the function `BayesTraits.shell.reg.proj` with all the needed parameters, you 
have to set permission to the shell script to run automatically all the phylogenetic 
regression analyses with BayesTraits program. You can just follow the steps below.\

__1.__ Open the terminal;\

__2.__ Go to the BayesTraits program folder where you have saved the shell script 
file __.sh__ and the associated running and input data files with the function `BayesTraits.shell`.
The shell script should be named __BayesTraits_full_shell_unix.sh__;\

__3.__ Execute the following line:\
__chmod 777 BayesTraits_full_shell_unix.sh__

__4.__ Then perform the BayesTraits run using the shell script by executing the following line:\
__./BayesTraits_full_shell_unix.sh__
\
\

# Creating a Windows PowerShell project folder

Set the argument `syst = "windows"` to create a PowerShell script for running the 
phylogenetic regressions with Windows. 

```{r, eval = FALSE}
BayesTraits.shell.reg.proj(dir_create_proj = "/Users/domingoscardoso",
                           syst = "windows")
```

```{r, echo = FALSE}
knitr::include_graphics("figures/windows_shell_project.png", dpi = 300)
```

\
\
Note that...
\
```{r, echo = FALSE}
knitr::include_graphics("figures/windows_shell_project_script.png", dpi = 300)
```
\
\

# Running the Windows PowerShell script 

After using the function `BayesTraits.shell.reg.proj` with all the needed parameters, you 
have to set permission to the PowerShell script to run automatically all the 
phylogenetic regression analyses with BayesTraits program. You can just follow the
steps below, but you may also want to find [further information on how to use Windows PowerShell](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.2).

__1.__ Open PowerShell as Administrator;\

__2.__ Go to the BayesTraits program folder where you have saved the PowerShell script
file __.ps1__ and the associated running and input data files with the function `BayesTraits.shell`.
The PowerShell script should be named __BayesTraits_full_shell_windows.ps1__;\

__3.__ Execute the following line and choose option __[Y]Yes__;\
__Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope LocalMachine__

__4.__ Execute the following line:\
__Unblock-File -Path .\\BayesTraits_full_shell_windows.ps1__

__5.__ Then perform the BayesTraits run using the PowerShell script by executing the following line:\
__.\\BayesTraits_full_shell_windows.ps1__

\
\
See also the associated articles on how to set the parameters to [create input files ](https://dboslab.github.io/InNOutBT/articles/independent_contrast_regression_inputs.html)
with `BayesTraits.inputs` for the phylogenetic regression analyses, as well to [create the internal shell script](https://dboslab.github.io/InNOutBT/articles/independent_contrast_regression_shell.html) with `BayesTraits.shell` for the actual BayesTraits runs, and to [process the resulting output files](https://dboslab.github.io/InNOutBT/articles/independent_contrast_regression_outputs.html) with `BayesTraits.outputs`.
