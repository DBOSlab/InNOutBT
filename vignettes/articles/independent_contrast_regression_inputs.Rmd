---
title: "Creating input data for independent contrast regressions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating input data for independent contrast regressions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The main goal of the __InNOutBT__ package is to readily create input data to and
process output data from Meade & Pagel's (2022) [BayesTraits](http://www.evolution.reading.ac.uk/BayesTraitsV4.0.0/BayesTraitsV4.0.0.html) 
computer package.\

Here in this article, we show how to use the package's function `BayesTraits.inputs`
for creating input linked and mean data for BayesTraits phylogenetic independent 
contrast regression analyses.


# Setup

__InNOutBT__ is not on CRAN yet but you can install the latest development version 
from [GitHub](https://github.com/):

``` r
#install.packages("devtools")
devtools::install_github("DBOSlab/InNOutBT")
```
```{r, eval = FALSE}
library(InNOutBT)
```


# Create sample of trait data using a different subset of explanatory variables

This function produces all BayesTraits input data of linked samples of trait/climate 
data (distribution data), by automatically generating two .txt files: one including 
the linked traits and the other with mean values for each included trait. The 
function also includes an argument to calculate the net node count for each
species/accession given a phylogenetic tree of reference, which has been successfully 
used to explore the effect of speciation rates (e.g. [Oâ€™Donovan et al. 2018](https://doi.org/10.1038/s41559-017-0454-6)) on the response variable.\

The example below shows how to mine all accepted species for a specified vector 
of families. 

```{r, eval = FALSE}
library(InNOutBT)
library(treeio)

traitdata <- read.csv("Data/vataireoids_1610_25May2022_BayesTraits.csv")
phylo <- read.beast("Data/vatcomb30_24May22_Yule.con.tree")

BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tipscol = "terminal",
                   traitcols = c("bio12", "bio15"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_bio12_bio15.txt",
                   fileMeanData = "BayesTraits_mean_data_bio12_bio15.txt")
```


# Create sample of trait data using a different subset of explanatory variables

To mine a species checklist for all families of flowering plants, you recommend to
load the dataframe-formatted data object called `POWOcodes` that comes associated with
the __expowo__ package. Because the `POWOcodes` data object already contains the 
URI addresses for all angiosperms families recognized in the [POWO](https://powo.science.kew.org) 
database, you do not need to perform the time-consuming URI search using __taxize__. \

The example below shows how to mine a global checklist of all accepted species of
flowering plants by using the vector of all angiosperm families and associated URI 
addresses stored in the `POWOcodes` object.

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tipscol = "terminal",
                   logtransf = "DBH",
                   traitcols = c("bio12", "bio15"),
                   addtraits = "log10DBH",
                   ordtraits = c("log10DBH", "bio12", "bio15"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_bio12_bio15.txt",
                   fileMeanData = "BayesTraits_mean_data_bio12_bio15.txt",
                   fileOrigData = "vataireoids_1610_25May2022_BayesTraits_DBH_logtransf.csv")
```


# Create sample of trait data using a different subset of explanatory variables

You can also narrow down the species checklist search of any family by
focusing on just a particular country or a list of countries. You just need to 
define a vector of country names in the argument \code{country}. In the example below,
note that we have originally searched for the species within the families 
__Amborellaceae__, __Cabombaceae__, and __Martyniaceae__, but the function 
returned a smaller species list, because many species in the searched families 
are not recorded in any of the specified vector of country, i.e. __Brazil__ or __Colombia__.

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tipscol = "terminal",
                   NodeCount = TRUE,
                   logtransf = c("DBH", "NodeCount"),
                   traitcols = c("bio12", "bio15"),
                   addtraits = c("log10NodeCount", "log10DBH"),
                   ordtraits = c("log10DBH", "bio12", "bio15", "log10NodeCount"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_bio12_bio15_nnodes.txt",
                   fileMeanData = "BayesTraits_mean_data_bio12_bio15_nnodes.txt",
                   fileOrigData = "vataireoids_1610_25May2022_BayesTraits_netnodes_logtransf.csv")
```


# Create sample of trait data using quadratic net nodes as the explanatory variable

You may want to retrieve information for just one or a list of accepted 
genera from a given country (or from a list of countries). Just like before,
you only need to define a vector of genus names in the argument \code{genus} and
a vector of country names in the argument \code{country}. In the example below,
see that we have again searched for just the genera ***Asarum*** and ***Bertholletia***
of the families __Aristolochiaceae__ and __Lecythidaceae__, but the function 
only returned the Lecythidaceae genus ***Bertholletia***, because ***Asarum*** 
does not occur in any of the provided list of countries, i.e. __Argentina__, __Brazil__ 
or __French Guiana__.

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tips_colname = "terminal",
                   NodeCount = TRUE,
                   logtransf = c("DBH", "NodeCount"),
                   sqrtransf = c("NodeCount"),
                   addtraits = c("sqrNodeCount", "log10DBH"),
                   ordtraits = c("log10DBH", "log10NodeCount", "sqrNodeCount"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_nnodes_nnodes2.txt",
                   fileMeanData = "BayesTraits_mean_data_nnodes_nnodes2.txt",
                   fileOrigData = "vataireoids_1610_25May2022_BayesTraits_netnodes_logtransf_sqrtransf.csv")
```


# Create sample of trait data using only longitude and latitude for the GEO model

You may want to retrieve information for just one or a list of accepted 
genera from a given country (or from a list of countries). Just like before,
you only need to define a vector of genus names in the argument \code{genus} and
a vector of country names in the argument \code{country}. In the example below,
see that we have again searched for just the genera ***Asarum*** and ***Bertholletia***
of the families __Aristolochiaceae__ and __Lecythidaceae__, but the function 
only returned the Lecythidaceae genus ***Bertholletia***, because ***Asarum*** 
does not occur in any of the provided list of countries, i.e. __Argentina__, __Brazil__ 
or __French Guiana__.

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tips_colname = "terminal",
                   NodeCount = FALSE,
                   traitcols = c("longitude", "latitude"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_GEO.txt",
                   fileMeanData = "BayesTraits_mean_data_GEO.txt")
```
