---
title: "Creating input data for independent contrast regressions"
output: rmarkdown::html_vignette
resource_files:
    - vouchered_dataset.png
vignette: >
  %\VignetteIndexEntry{Creating input data for independent contrast regressions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The main goal of the __InNOutBT__ package is to readily create input data to and
process output data from Meade & Pagel's (2022) [BayesTraits](http://www.evolution.reading.ac.uk/BayesTraitsV4.0.0/BayesTraitsV4.0.0.html) 
computer package.\

Here in this article, we show how to use __InNOutBT__'s function `BayesTraits.inputs`
for creating BayesTraits input data of linked samples of trait/climate data 
(distribution data) for phylogenetic independent contrast regression analyses. 
This function automatically generates two .txt files: one including the linked traits
and the other with mean values for each included trait. The function also includes 
an argument to calculate the net node count for each species/accession given a 
phylogenetic tree of reference, which has been successfully used to explore the 
effect of speciation rates (e.g. [O’Donovan et al. 2018](https://doi.org/10.1038/s41559-017-0454-6))
on the response variable.\


# Setup

__InNOutBT__ is not on CRAN yet but you can install the latest development version 
from [GitHub](https://github.com/):

``` r
#install.packages("devtools")
devtools::install_github("DBOSlab/InNOutBT")
```
```{r, eval = FALSE}
library(InNOutBT)
```


# Example of spreadsheet with georeferenced data and associated traits

Before using `BayesTraits.inputs`, make sure your spreadsheet with georeferenced
data and associated traits also includes a **terminal** column where each accession/sample are linked with its corresponding tip label in the input phylogenetic tree.\
\
```{r, echo = FALSE}
knitr::include_graphics("figures/vouchered_dataset.png", dpi = 300)
```


# Create sample of trait data using a subset of explanatory variables

The example below creates the linked and mean data files where "DBH" was defined 
as the response variable whereas "bio12" and "bio15" are the explanatory variables. 
In other words, the first name in the argument `traitcols` will define the 
response variable.\

```{r, eval = FALSE}
library(InNOutBT)
library(treeio)

traitdata <- read.csv("Data/vataireoids_1610_25May2022_BayesTraits.csv")
phylo <- read.beast("Data/vatcomb30_24May22_Yule.con.tree")

BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tipscol = "terminal",
                   traitcols = c("DBH", "bio12", "bio15"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_bio12_bio15.txt",
                   fileMeanData = "BayesTraits_mean_data_bio12_bio15.txt")
```


# Log transform any variable before creating the input linked and mean data

You may want to log-10 transform a variable before running the phylogenetic regressions.
You just need to provide in the argument `logtransf` the variables/traits to 
be log-transformed. The log-transformed trait will always result in a new column 
with a new name where the additional prefix "log10" is added as following: "log10NAMEOFTHETRAIT".
The name(s) of the log-transformed trait(s) to be used in the analyses should then 
be listed in the argument `addtraits`. Note that in the example below the variable
"DBH" was chosen to be log-transformed and also as the response variable. In this 
case, we need to reorder the variables in the argument `ordtraits` so as to 
make sure your newly generated "log10DBH" variable will remain on front, i.e. as 
the response variable. You may also want to save the original spreadsheet including 
the new column of log-transformed DBH by giving a name in the argument `fileOrigData`.\

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tipscol = "terminal",
                   logtransf = "DBH",
                   traitcols = c("bio12", "bio15"),
                   addtraits = "log10DBH",
                   ordtraits = c("log10DBH", "bio12", "bio15"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_bio12_bio15.txt",
                   fileMeanData = "BayesTraits_mean_data_bio12_bio15.txt",
                   fileOrigData = "vataireoids_1610_25May2022_BayesTraits_DBH_logtransf.csv")
```


# Create sample of trait data using a different subset of explanatory variables

By setting the argument `NodeCount = TRUE`, the function will calculate the net 
node count for each species/accession given the phylogenetic tree of reference. 
Net node has been successfully used to explore the effect of speciation rates 
(e.g. [O’Donovan et al. 2018](https://doi.org/10.1038/s41559-017-0454-6)) on the 
response variable. See that in the example below we have also chosen to log10-transform 
both the response variable "DBH" and the newly created column of net node, all which 
were then listed in the arguments `addtraits` and `ordtraits`.\

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tipscol = "terminal",
                   NodeCount = TRUE,
                   logtransf = c("DBH", "NodeCount"),
                   traitcols = c("bio12", "bio15"),
                   addtraits = c("log10NodeCount", "log10DBH"),
                   ordtraits = c("log10DBH", "bio12", "bio15", "log10NodeCount"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_bio12_bio15_nnodes.txt",
                   fileMeanData = "BayesTraits_mean_data_bio12_bio15_nnodes.txt",
                   fileOrigData = "vataireoids_1610_25May2022_BayesTraits_netnodes_logtransf.csv")
```


# Create sample of trait data using quadratic net nodes as the explanatory variable

You may want to square transform a variable before running the phylogenetic regressions.
You just need to provide in the argument `sqrtransf` the variables/traits to 
be squared. The square-transformed trait will always result in a new column 
with a new name where the additional prefix "sqr" is added as following: "sqrNAMEOFTHETRAIT".
The name(s) of the square-transformed trait(s) to be used in the analyses should 
then be listed in the argument `addtraits`. Note that in the example below the newly 
created variable "NodeCount" was chosen to be both log- and square-transformed.\

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tips_colname = "terminal",
                   NodeCount = TRUE,
                   logtransf = c("DBH", "NodeCount"),
                   sqrtransf = c("NodeCount"),
                   addtraits = c("sqrNodeCount", "log10DBH"),
                   ordtraits = c("log10DBH", "log10NodeCount", "sqrNodeCount"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_nnodes_nnodes2.txt",
                   fileMeanData = "BayesTraits_mean_data_nnodes_nnodes2.txt",
                   fileOrigData = "vataireoids_1610_25May2022_BayesTraits_netnodes_logtransf_sqrtransf.csv")
```


# Create sample of trait data for GEO model

The example below shows that you can also define the columns of "longitude" and
"latitude" from your original spreadsheet so as to create input linked and mean
data for geographic-model-based phylogenetic regression.\

```{r, eval = FALSE}
BayesTraits.inputs(tree = phylo,
                   data = traitdata,
                   tips_colname = "terminal",
                   NodeCount = FALSE,
                   traitcols = c("longitude", "latitude"),
                   dir_create = "results_BayesTraits_input",
                   fileDistData = "BayesTraits_linked_data_GEO.txt",
                   fileMeanData = "BayesTraits_mean_data_GEO.txt")
```


See also an associated article on how to create a [shell script](https://dboslab.github.io/InNOutBT/articles/independent_contrast_regression_shell.html)) with `BayesTraits.shell` for multiple phylogenetic regression analyses, as well as
another article on how to use `BayesTraits.outputs` to [process the resulting output files](https://dboslab.github.io/InNOutBT/articles/independent_contrast_regression_outputs.html)) from the analyses.

